# Riz - 硬件接口详细信息

本文档详细说明了 Riz 设备的硬件连接、引脚分配和要求，主要关注 ESP32 模块接口。

## 目录

- [Riz - 硬件接口详细信息](#yoach-1---硬件接口详细信息)
  - [目录](#目录)
  - [1. ESP32 模块](#1-esp32-模块)
  - [2. 电源供应](#2-电源供应)
  - [3. 主要引脚分配（ESP32 模块引脚）](#3-主要引脚分配esp32-模块引脚)
  - [4. 编程/串行接口](#4-编程串行接口)
  - [5. 传感器接口](#5-传感器接口)
  - [6. 启动模式选择](#6-启动模式选择)

## 1. ESP32 模块

*   **模块：** ESP32-WROOM-32（例如原理图中所示的 ESP32-WROOM-32-N8）或兼容变体。

## 2. 电源供应

*   **输入电压：** 通常通过 USB 提供 5V。
*   **工作电压：** ESP32 模块和大多数外围设备运行在 **3.3V**。板上稳压器将 5V 输入转换为 3.3V。
*   **电流需求：** 3.3V 供应必须稳定，能够提供 >500mA 峰值电流，特别是在 Wi-Fi/BLE 传输和闪存访问期间。电源不足可能导致欠压重启和不稳定。
*   **去耦：** 充分的去耦电容是**关键**，必须靠近 ESP32 VDD33 和 GND 引脚放置：
    *   必需：10µF（低 ESR，例如陶瓷或钽质）+ 0.1µF（陶瓷）。
    *   推荐：47µF-100µF（低 ESR 电解质/钽质）+ 1µF（陶瓷）+ 0.1µF（陶瓷）。

## 3. 主要引脚分配（ESP32 模块引脚）

*（请参考特定的 Riz 原理图了解确切的元器件连接和引脚编号）*

| ESP32 引脚 | GPIO # | Riz 功能        | 备注                                      |
| :-------- | :----- | :---------------------- | :----------------------------------------- |
| 2         | -      | VDD33                   | **3.3V 电源输入**。需要去耦。 |
| 3         | -      | EN（使能/复位）       | 连接到复位按钮和自动编程。需要 10kΩ 上拉至 3.3V。 |
| 35        | GPIO35 | TX_ESP32（UART0 TX）     | 默认 UART 用于编程/日志记录。连接到 USB 串行 RX。 |
| 34        | GPIO34 | RX_ESP32（UART0 RX）     | 默认 UART 用于编程/日志记录。连接到 USB 串行 TX。 |
| 25        | GPIO25 | IO0（启动选择）       | 连接到启动按钮和自动编程。需要 10kΩ 上拉至 3.3V。启动时拉低进入下载模式。 |
| （待定引脚） | GPIO ? | RGB_LED_PIN           | NeoPixel LED 灯条的数据引脚。           |
| （待定引脚） | GPIO ? | led_pin                 | 简单的板载/状态 LED（如果存在）。    |
| 30        | GPIO30 | 蜂鸣器                  | 压电蜂鸣器的输出引脚。             |
| 36        | GPIO36 | RX_TOF（UART2 RX）       | TF-Luna 传感器的 UART RX。              |
| 37        | GPIO37 | TX_TOF（UART2 TX）       | TF-Luna 传感器的 UART TX。              |
| 33        | GPIO33 | RX_MMWAVE（UART1/2 RX？） | 毫米波雷达的 UART RX。检查 `Global_VAR.h`。 |
| 13        | GPIO13 | TX_MMWAVE（UART1/2 TX？） | 毫米波雷达的 UART TX。检查 `Global_VAR.h`。 |
| 14        | GPIO14 | SCL                     | I2C 时钟（如果使用 I2C 外围设备）。 |
| 15        | GPIO15 | CTOUCH                  | 电容式触摸输入（如果使用）。        |
| （待定引脚） | GPIO ? | ADC                     | ADC 输入（例如用于电池监测）。`Pangodream_18650_CL` 默认可能使用 GPIO35。检查库/`Global_VAR.h`。 |
| 31        | GPIO31 | PWR_SIGNAL              | 用途待定 - 检查应用逻辑。   |
| 1, 16, 38, 39 | -    | GND                     | 地线连接。必须连接良好。 |
| 4, 5, 6, 7, 8, 9, 10, 11, 12, 17, 18, 19, 20, 21, 22, 23, 24, 26, 27, 28, 29, 32 | GPIOs | 其他可用 GPIO    | 检查原理图/`Global_VAR.h` 了解具体用途（例如 I2S 音频、SD 卡、EN_BT）。 |

**注意：** 引脚编号指标准 ESP32-WROOM-32 引脚排列。如果使用不同的模块或自定义板，请查阅您的特定原理图。外围设备（LED、蜂鸣器、ADC 等）的引脚分配应在 `include/Global_VAR.h` 中确认。

## 4. 编程/串行接口

*   默认使用 UART0（TXD0：GPIO35，RXD0：GPIO34，但请检查原理图）连接到板载或外部 USB 到串行转换芯片（例如 CH340、CP210x）。
*   自动编程依赖于来自 USB 到串行转换芯片的 DTR 和 RTS 信号通过特定的 RC 电路（通常内置在开发板中）正确切换 EN 和 IO0 引脚。如果自动上传失败，请参阅 `TROUBLESHOOTING.md`。

## 5. 传感器接口

*   **TF-Luna：** 通过 UART 连接（检查 `Global_VAR.h` 或 `main.cpp` 中的 `TOF_SERIAL`、`TOF_RX_PIN`、`TOF_TX_PIN` 定义）。
*   **毫米波雷达：** 通过 UART 连接（检查 `Global_VAR.h` 或 `main.cpp` 中的 `RADAR_RX_PIN`、`RADAR_TX_PIN` 定义）。

## 6. 启动模式选择

*   **正常启动（从闪存运行）：** EN 从 LOW 变为 HIGH 时，GPIO0 必须为 HIGH。
*   **下载模式（固件上传）：** EN 从 LOW 变为 HIGH 时，GPIO0 必须为 LOW。这可通过手动按下 BOOT 按钮序列或通过 DTR/RTS 电路自动完成。

---
